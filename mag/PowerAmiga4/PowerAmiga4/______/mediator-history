<NAME " Медиатор">
                     <IMG src="pics/mediator.png" alt="Медиатор">. <B>Или первый PCI на Амиге.</B>

Большинству амижников надоело сидеть на AGA и они подумывают о приобретении
видео-карты. Данная статья приоткрывает завесу над этим вопросом :-)

Пролог.
Началось  всё  с  того, что полтора года назад мне очень захотелось заиметь
видео-карту.   И я стал думать и потихоньку выбирать к чему стремиться, что
купить, в зависимости от моей конфигурации.  В конце концов я определился и
выбрал быструю тогда BlizzardVisionPPC.  Оказалось, что она работает только
с  PPC-акселератором.   Не  долго  думая  решил, что хватит сидеть на голой
машине.   Продавцом выбрал Женю Степанова (2:5030/221.0@FidoNet) Перечислил
деньги   и.....    стал   ждать.   Под  конец  ноября  '99  пришёл  аксель.
BPPC603p-175/040-25.   Оказалось, что для хоть какой-либо работы, ему нужна
fast-память.   BVPPC не пришёл из-за временного прекращения производства, а
потом  и  вообще  продажи  всех лицензий DCE.  DCE возобновило производство
только  весной.   Пока  шло  время появился анонс о Mediator PCI.  Он давал
возможность  подключать  дешёвые  PCI-карты.   Ещё пол-года я тянул.  BVPPC
постепенно  дорожал,  а  меня  терзали всевозможные соблазны :-) Я оценивал
плюсы  и  минусы обоих вариантов покупки, и в итоге остановился всё таки на
медиаторе.   AmigaLine  обьявила  о  низких  ценах,  и я сделал туда заказ.
Через  неделю  (опять  под  конец ноября, но уже '00) друг привёз ЕГО.  Тут
оказалось  что  с  медиатором,  в  мой  tower  не влезает аксель.  Пришлось
выпилить  дырку :-) Взял у соседа карточку S3 Virge DX 2MB.  Стал примерять
и  подумал,  что  товер  у меня будет всё время открытым из-за невлезающего
акселя.   На следующий день этот недостаток был устранён, путём сдвига всей
материнки  вниз.   До  кучи  естественно  пришлось выпилить большую дырку в
задней стенке для разъёмов на карточки.

Как  видно  на  картинке,  медиатор  представляет  из  себя  плату примерно
16х16см, с 4-мя слотами PCI, несколькими съёмными чипами и разъёмом питания.
Крепится  медиатор  параллельно  материнке,  при этом зазор до неё остаётся
примерно  2см.   И  ещё  один  нюанс:   в  комплекте  есть маленькая плата,
выполняет  роль  разветвителя.   Вставляется  в  Trapdoor,  а  уже  в  него
вставляется в один разъём медиатор, а в другой аксель.  При этом аксель как
бы  отодвигается  от  материнки  на  2см, из-за чего он у меня как раз и не
влезал в товер :-)


Вот основные характеристики медиатора:

· 4 PCI слота (стандарт PCI 2.1)
· Частота шины PCI 33 MHz (66 MHz с акселератором SharkPPC G3/G4)
· 32 bit PCI шина данных
· Плата механически совместима с Amiga 1200 в E/BOX (Power Tower)
  и Infinitiv tower cases
· Трансфер между PCI устройствами до 132 MB/s 
  (264 MB/s с акселератором SharkPPC G3/G4)
· Работает с любыми 68k и PPC акселераторами

И системные требования:

Минимальная конфигурация:
· Amiga 1200T с PC-блоком питания
· 4 MB Fast RAM
· Жёсткий диск

Рекомендованная конфигурация:
· Amiga 1200T в E/BOX (Power Tower) корпусе
· 68060/50 MHz или 68040/40 MHz процессор
· 32 MB или больше Fast RAM в 68k-акселераторе
· PCI графическая карта
· SharkPPC G3/G4 акселератор
· 64 MB или больше SDRAM в SharkPPC G3/G4 акселераторе
· Жёсткий диск

PC-блок питания нужен только для питающих шнуров P8 и P9.

На  плате  медиатора  есть  несколько  перемычек,  остановлюсь  на тех, что
называются Memory Window.  Можно выставить три положения: 0MB, 4MB и 8MB, и
они прямым образом влияют на трансфер с PCI видео-картами.
И  ещё один момент:  как показали тесты, на акселераторах Apollo трансфер с
медиатором несколько выше, чем на акселераторах Blizzard.


Теперь   стал   вопрос,  как  доставать  свежие  драйвера?   Всё  оказалось
достаточно  просто.   Нужно всего лишь зарегистрироваться у Elbox, для чего
надо заполнить следующую форму:

=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=
REGISTRATION

For e-mail updates of drivers written for PCI cards for the 
MEDIATOR PCI 1200 busboard, please send a message
to:       support@elbox.com
subject:  subscribe MEDIATOR PCI 1200 drivers
body:     <your name>,
          <your mailing address>,
          <your DRIVERS version>,
          <the serial number of your MEDIATOR PCI 1200 busboard 
           (the 7-digits number on MEDIATOR board and on the box)>,
          <company where busboard was purchased>.
=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=

Теперь  мне  стали приходить все новые версии драйверов, и пока наблюдается
периодичность в их обновлении примерно раз в месяц.
На  текущий  момент вообще их немного.  Поддерживаются видео-карты на чипах
S3 ViRGE 86C325 и ViRGE/DX 82C375, а так же видео-карты
 * Voodoo Banshee 8 MB
 * Voodoo3 2000/3000 16 MB 
 * Voodoo4 4500 32 MB 
 * Voodoo5 5500 64 MB 

и следующие сетевые карты:

             (Vendor ID, Product ID)
Winbond 89C940F   (1050, 0940)
Winbond 89C940F   (1050, 5A5A)
RealTek RTL-8029  (10EC, 8029)
NetVin NV5000SC   (4A14, 5000)
Holtek HT80232    (12C3, 0058)
Holtek HT80229    (12C3, 5598)
Compex RL2000     (11F6, 1401)
SureCom NE34      (10BD, 0E34)
KTI ET32P2        (8E2E, 3000)
Via 86C926        (1106, 0926)

В ближайшем будущем обещают выпустить много разных драйверов практически для
всей периферии PCI.
Так же авторы Warp3D уже скоро должны доделать поддержку для карт Voodoo.


Итак, не буду забегать вперёд :-)
У меня наконец-то появилась видео-карта!!!

Сразу же купил себе нормальный монитор - ViewSonic PF775 "17.
Радости моей не было предела.  Я мог открывать большие экраны с достаточной
глубиной  цвета.   Больше никаких 640x512x8 максимум, ни какого интерлейса,
этого  мерзкого  дрожания  экрана,  на  которое  долго-то  и не посмотришь.
Естественно  всё  это было на телевизоре :-) По сравнению с AGA всё летало,
отлично   чувствовался   большой  прирост  скорости.   Теперь  не  кушалась
чип-память на экраны, всё происходило в памяти видео-карты.
Вообщем  я  был  очень  доволен.  И всё же три вещи не давали радоваться на
полную катушку.
Во-первых  я  осознавал,  что  S3 не такая уж и быстрая карта, и можно было
посмотреть  работу  Амиги  на  более  шустрой карте.  К тому же её 2MB тоже
давали  о  себе  знать:   все  открытые  экраны хранились в этих двух мегах
(можно  провести аналогию с чип-памятью - те же 2 мега), и если учесть, что
эти  экраны  как правило были 800x600x16, то нетрудно посчитать, что памяти
хватало  всего  на 2 экрана.  И с этим приходилось пока мириться.  И я стал
подумывать о другой видяхе, с бОльшим количеством памяти.
Во-вторых,  меня очень огорчила скорость скроллинга.  Мягко говоря она была
просто  никакая, или проще говоря - её ВООБЩЕ не было.  Кого винить в этом?
Скорее  всего  разработчиков  драйверов, т.к.  они специально отключили всё
аппаратное  ускорение  карточки,  видимо в расчёте на коммерческие драйвера
под CGX4.
В-третьих,  поддержка  S3  была  только  под  CGX3.  И именно эта CGX3 меня
смущала    и    немного    расстраивала.    Это   уже   достаточно   старая
видео-подсистема, в которой нету многих современных фишек.  В итоге я сидел
на  старенькой  видео-карте  с поддержкой лишь старенькой видео-подсистемы.
Прям как на помойке :-)) (DG:  Hi!)

Короче, я решил взять себе Voodoo3 16MB.  Это оказалось не так уж и просто.
В  городе  были  большие  проблемы  с  любыми  видео-картами, даже AGP (был
какой-то  временный  кризис).   Как  оказалось,  в  Москве тоже с этим были
достаточные проблемы. Вообщем, еле удалось через друзей найти Voodoo3 3000.
Карточка обошлась мне в $95.
Драйвера  работали  только под видео-подсистему Picasso96.  После небольших
поисков на сайтах, я решил просто взять этот пакет из OS3.9, благо я ей уже
обзавёлся,  но поставить ещё не успел.  Это был самый простой выход, к тому
же выше версии 2.0 по-моему всё равно пока нету.
P96  по  сравнению  с CGX3 оказалась просто раем!  Тут было всё о чём можно
было  только мечтать!  К тому же это всё достаточно просто и наглядно.  Это
и поддержка нескольких карточек одновременно, и детальная настройка КАЖДОГО
разрешения  экрана,  и  хорошая  связка  с  подсистемой  RTG  для поддержки
различных  игр  и  демок, и классный режим PIP (картинка в картинке) как на
телевизорах,  до кучи есть возможность эмуляции CGX, и эмуляция PAL (правда
корректно  она работает, если PAL-экран открывать на 100% средствами OS), и
естественно  самое  главное - возможность тщательной настройки параметров и
возможностей  видео-карт,  например,  можно  отключить  блиттер  Амиги, или
блиттер  карты,  или  использовать  програмную  поддержку спрайтов.  Короче
много чего можно контролировать - там настраивается около тридцати пунктов.
Вообщем делайте сами выводы о ГИБКОСТИ Picasso96.
Ничего  подобного  в  CGX3  я  не видел вообще.  CGX4 в работе наблюдать не
приходилось  и  о  ней  судить  никак  не  могу (надеюсь в следующем номере
журнала будет разгромная статья о рулезности CGX4 :-))
И  ещё.   Не  хочу  показаться  голословным,  но  всё  же:   люди,  реально
работавшие на CGX4 и на P96, говорят, что P96 более шустрая.

Теперь  о  Voodoo3.   Всё  стало летать ещё быстрее.  Теперь практически не
было  ограничений  на  количество экранов: всё равно больше 16 я никогда не
открою :) Графика заметно ускорилась, особенно меня порадовали скроллинги -
они просто летали!  Короче говоря с 2D закончились абсолютно все проблемы в
ЛЮБЫХ  разрешениях.   Осталось  лишь  только  доделать поддержку 3D и можно
полностью наслаждаться Амигой.  Как ни странно, один минус всё таки омрачил
такой  рулез:   вкратце,  ходят  слухи,  что при задействовании верхних 4MB
медиатора,  появляется  глюк,  выражающийся  в  порче графики вертикальными
полосами.  Однако те же слухи утверждают, что этот глюк присутствует только
в  первой партии медиаторов.  Компания Elbox официально заявила, что это не
глюк медиатора, а лишь результат аппаратной защиты:

=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=

 Rumour: If your jumper is set on 8MB and you have 'vertical lines'
         trashing on the screen, you may have a buggy board.

 No, it is not the true.
 The fact of appearing 'vertical lines' on the screen is definitely not the
 result of any fault of Mediator's board.
 The presence of 'vertical line' is the result of the hardware  protection,
 which was installed in Mediator's busboards.

 In order to avoid 'vertical lines' it is enough to set the 'memory window'
 jumper to 4 MB according to Mediator User's Manual.

 The hardware protection was designed to enable the sell of commercial
 software for Mediator's busboard secured by the hardware key, which was
 supposed to be available together with that software.
 After the negotiations on WOA 2000 we have changed our plans as far as the
 distribution of the graphic drivers with full hardware acceleration
 implemented is concerned.
 As a result of this decision the protection had been removed from the
 Mediators that are being sold after the 13th December 2000.

=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=-=+=

Действительно ли это защита и от чего, пока непонятно.  Я тоже столкнулся с
этой  проблемой  в  режиме  8MB  и  единственный пока выход - это поставить
перемычку  на  медиаторе в положение 4MB.  Позже Elbox убрал эту "защиту" и
теперь  данной  проблемы  не  существует.   При  покупке медиатора обратите
внимание  на  его  серийный  номер, т.к.  эта проблема актуальна только для
номеров с 3200001 по 3201338.
Кстати,  я  заметил,  что  почти  все  тесты  в  режиме  4MB выдают бОльшие
результаты, чем в 8MB.


Перед  самым  выходом  номера,  Elbox  прислал  драйвера  для  S3 Virge под
Picasso96.  Теперь у S3 полностью поддержаны все 2D эффекты.


А теперь результаты тестов :-)
Следует учесть, что они все проводились на достаточно слабеньком процессоре
MC68040  25MHz.   Из патчей - Setpatch 43.6, KingCon.  При тестах в CGX-AGA
был ещё установлен FBlit.


P96Speed 1.2 - ©`97-99 by Jens Langner
.--------------------------------.
| Computer......: Amiga 1200/AGA |
| CPU...........: 68040/25 MHz   |
| OS / WB.......: V40.68/V40.42  |
| SetPatch......: V43.6          |
| Chip/Fast.....: ~2.0MB/63.0MB  |
| Testlength....: 13             |
`--------------------------------'
.----------------------.---------.---------.---------.---------.
|                      |   CGX   |   CGX3  |   P96   |   P96   |
|                      |   AGA   | S3 Virge| S3 Virge| Voodoo3 |
|                      |640x512x8|640x480x8|640x480x8|640x480x8|
)==== SPEEDRESULTS ====+== op/s =+=========+=========+=========(
| RectFill()           |     30  |     82  |   2464  |  10651  |
| RectFill() Pattern   |     13  |     46  |   2332  |   9007  |
| WritePixel()         |  21041  |  92857  |  58291  |  58162  |
| WriteChunkyPixels()  |     21  |    258  |    348  |    349  |
| WritePixelArray8()   |    124  |    333  |    342  |    344  |
| WritePixelLine8()    |   8204  |   8972  |  11497  |  11296  |
| DrawEllipse()        |    155  |   3428  |   5366  |   5178  |
| DrawCircle()         |    167  |   5991  |   6503  |   6325  |
| Draw()               |    120  |   2076  |   7318  |  12913  |
| Draw() Hor/Ver       |    180  |   4490  |  11059  |  12711  |
| ScrollRaster() X     |      3  |      3  |    137  |   1882  |
| ScrollRaster() Y     |      4  |      7  |    136  |   1975  |
| PutText()            |    564  |   1315  |   3062  |   3995  |
| BlitBitMap()         |    195  |    231  |   3956  |   7591  |
| BlitBitMapRastPort() |    193  |    227  |   3136  |   4841  |
| BitMapScale()        |     21  |     35  |     53  |     57  |
)----- Intuition ------+---------+---------+---------+---------(
| OpenWindow()         |     10  |     32  |     59  |     61  |
| MoveWindow()         |     16  |     22  |    238  |    317  |
| SizeWindow()         |     12  |     50  |     80  |     81  |
| CON-Output           |     55  |     16  |    117  |    328  |
| ScreenToFront()      |     51  |     26  |     59  |     71  |
`======================"========="========="========="========='


Для любителей поиздеваться :) - немного расширенные тесты:
Неудивляйтесь, что здесь немного другие результаты - они сделаны совершенно
другой програмой...


SysSpeed V2.6  - TestResults
============================

.-------------.---------.---------.---------.---------.
|   Test      | AGA-CGX | S3-CGX3 | S3-P96  | V3-P96  |
)-------------+---------+---------+---------+---------(
|  Intuition    Results in Op/s                       |
)-------------+---------+---------+---------+---------(
| OpenWin16   |  10     |  9      |  16     |  19     |
| OpenWin256  |  5      |  9      |  19     |  19     |
| OpenWinHi   |  ----   |  8      |  15     |  19     |
| OpenWinTru  |  ----   |  6      |  14     |  17     |
| WinLayer16  |  8      |  12     |  21     |  23     |
| WinLayer256 |  4      |  11     |  21     |  23     |
| WinLayerHi  |  ----   |  9      |  18     |  23     |
| WinLayerTru |  ----   |  6      |  9      |  20     |
| SizeWin16   |  36     |  56     |  63     |  72     |
| SizeWin256  |  27     |  59     |  64     |  68     |
| SizeWinHi   |  ----   |  53     |  50     |  63     |
| SizeWinTru  |  ----   |  27     |  55     |  61     |
| MoveWin16   |  29     |  39     |  172    |  228    |
| MoveWin256  |  29     |  36     |  166    |  212    |
| MoveWinHi   |  ----   |  13     |  100    |  202    |
| MoveWinTru  |  ----   |  26     |  72     |  175    |
| ConOutP16   |  38     |  16     |  54     |  104    |
| ConOutP256  |  28     |  16     |  55     |  103    |
| ConOutPHi   |  ----   |  15     |  42     |  112    |
| ConOutPTru  |  ----   |  14     |  29     |  98     |
| OpenScr16   |  4      |  3      |  12     |  12     |
| OpenScr256  |  2      |  2      |  12     |  12     |
| OpenScrHi   |  ----   |  2      |  9      |  10     |
| OpenScrTru  |  ----   |  1      |  0      |  10     |
| SwapScr16   |  50     |  50     |  59     |  71     |
| SwapScr256  |  50     |  25     |  59     |  71     |
| SwapScrHi   |  ----   |  25     |  59     |  70     |
| SwapScrTru  |  ----   |  25     |  1      |  71     |
)-------------+---------+---------+---------+---------(
|  Graphic      Results in Op/s                       |
)-------------+---------+---------+---------+---------(
| ScrollX_16  |  8      |  1      |  136    |  1975   |
| ScrollX_256 |  3      |  3      |  136    |  1973   |
| ScrollX_Hi  |  ----   |  1      |  47     |  1259   |
| ScrollX_Tru |  ----   |  1      |  23     |  854    |
| ScrollY_16  |  11     |  1      |  135    |  2108   |
| ScrollY_256 |  4      |  6      |  135    |  2108   |
| ScrollY_Hi  |  ----   |  1      |  46     |  1315   |
| ScrollY_Tru |  ----   |  1      |  22     |  887    |
| PrintTxt16  |  1598   |  915    |  1871   |  2798   |
| PrintTxt256 |  770    |  913    |  1871   |  2797   |
| PrintTxtHi  |  ----   |  738    |  1876   |  2797   |
| PrintTxtTru |  ----   |  488    |  1866   |  2784   |
| RectFill16  |  575    |  882    |  7378   |  12685  |
| RectFill256 |  216    |  882    |  7377   |  12681  |
| RectFillHi  |  ----   |  467    |  3581   |  12095  |
| RectFillTru |  ----   |  241    |  2011   |  11584  |
| DrwElpse16  |  218    |  3170   |  5367   |  5286   |
| DrwElpse256 |  118    |  3161   |  5368   |  5286   |
| DrwElpseHi  |  ----   |  501    |  5266   |  5290   |
| DrwElpseTru |  ----   |  537    |  2979   |  3000   |
| DrwCircle16 |  205    |  6178   |  6177   |  6224   |
| DrCircle256 |  112    |  6172   |  6189   |  6221   |
| DrwCircleHi |  ----   |  5596   |  6084   |  6147   |
| DrCircleTru |  ----   |  5146   |  2826   |  2843   |
| WrtPixel16  |  28292  |  49450  |  44415  |  43796  |
| WrtPixel256 |  18004  |  59960  |  44690  |  43798  |
| WrtPixelHi  |  ----   |  46200  |  45408  |  44798  |
| WrtPixelTru |  ----   |  47777  |  43302  |  42570  |
| HorLines16  |  258    |  5216   |  13396  |  12795  |
| HorLines256 |  97     |  5208   |  13395  |  12786  |
| HorLinesHi  |  ----   |  3360   |  12181  |  13037  |
| HorLinesTru |  ----   |  2008   |  9360   |  12946  |
| VerLines16  |  339    |  2218   |  6880   |  12344  |
| VerLines256 |  128    |  2213   |  6882   |  12298  |
| VerLinesHi  |  ----   |  1571   |  5755   |  12223  |
| VerLinesTru |  ----   |  1149   |  4011   |  11652  |
| DiaLines16  |  293    |  1996   |  6947   |  12257  |
| DiaLines256 |  125    |  1994   |  6961   |  12259  |
| DiaLinesHi  |  ----   |  1607   |  5868   |  11750  |
| DiaLinesTru |  ----   |  1189   |  4081   |  11267  |
| AreaElps16  |  138    |  89     |  132    |  140    |
| AreaElps256 |  92     |  89     |  131    |  139    |
| AreaElpsHi  |  ----   |  87     |  131    |  138    |
| AreaElpsTru |  ----   |  88     |  131    |  140    |
| AreaCir16   |  128    |  80     |  126    |  135    |
| AreaCir256  |  82     |  80     |  126    |  135    |
| AreaCirHi   |  ----   |  79     |  126    |  132    |
| AreaCirTru  |  ----   |  80     |  126    |  134    |
| AreaFill16  |  176    |  82     |  357    |  530    |
| AreaFill256 |  84     |  82     |  358    |  527    |
| AreaFillHi  |  ----   |  78     |  359    |  526    |
| AreaFillTru |  ----   |  81     |  359    |  525    |
`-------------"---------"---------"---------"---------'


2001 (c) Vinnny          vinnny@aport.ru
