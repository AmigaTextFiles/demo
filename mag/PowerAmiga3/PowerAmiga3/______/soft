                                    <B>PATCHES</B>

 В  прошлом  номере журнала мы разказывали о патчах к AmigaOS, которые подменяют
её   вызовы   отчвечающие   за  вывод  графики  (оконнный  интерфейс,  рисование
линий,точек  и  т.п.).   Нам поступило предложение более подробнее рассказать об
этом.
 В  этой  статье  мы  коснёмся патчей, их ещё называют "заплатками", ускоряющими
графику и экономищими chip ram.  Все эти "заплатки" в основном предназначены для
машин со стандартным AGA chipset'ом т.е.  не использующих видеокарты.

 Кроме  обычного  описания  этих патчей, я приведу таблицу из тестовой программы
SysSpeed,  так  что вы сможете самостоятельно оценить пользу от данных программ.
Данная  статья не является истиной в последней инстанции и решение использовать,
или  не  использовать приведённые в ней советы остаётся за вами, а также если вы
хотите дополнить данный материал обратитесь в редакцию.

 Я  давно занимаюсь проблеммой ускорения работы системной графики т.к.  меня (да
и многих Вас, читатели) не устраивала скорость её работы в высоких разрешениях и
большим  количеством  цветов.   Это  естественно  касается  AGA  чипсета.  Можно
конечно решить эту проблемму покупкой быстрой видеокарты, но такой возможности у
меня,  да  и большинства Amiga user'ов пока нет, но к счастью Amiga почти всегда
предлагает нам альтернативный вариант.

 Ниже я рассмотрю следующие патчи:

 CGXAGA,  CyberBugFix,  MCP,  FBlit,  Ftext,  QBC, BlazeWCP, SmartWB и на каждой
остановлюсь  подробнее.  У меня в системе стояли все вышеперечисленные патчи и я
вполне хорошо представляю, что каждый из себя представляет.

                                      <B>MCP</B>

 Начнём  с  MCP.   В ней есть две функции подменяющие системные функции работы с
окнами  (правильнее  со  слоями  -  layers) и рисованием линий - это QuickDraw и
QuickLayers.   Они действительно существенно ускоряют рисование линий и точек, а
также  перемещение  окон.   В  установках  можно включить обе, но если Вы будете
использовать FBlit (о нём пойдёт речь дальше), то QuickDraw необходимо отключить
т.к.   аналогичная  функция  в  FBlit работает быстрее.  Если Вы ещё используете
CGXAGA  или  CyberBugFix,  то  можете  смело отключать обе функции, практическая
необходимость в них отпадает.
 Установка MCP проста - необходимо её прописать в startup-sequence после команды
SetPatch, но до вызова LoadWB.  MCP можно найти на aminet в util/boot

                              <B>CGXAGA, CyberBugFix</B>.

 Две  программы  занимающиеся,  вообще-то  одним  и  тем же.  Это видоизменённая
система  поддержки  внешних  видеокарт.   Но её немножко переделали и она теперь
может функционировать на чипсете.  Ускорение здесь достигается за счёт того, что
операции  с  графикой  идут  в  быстрой  fast-памяти.   Эти программы используют
библиотеку  cgxsystem.library,  в  которой  располагается  библиотека заменяющая
стандартную  layers.library.   И это даёт не только ускорение, но и существенную
экономию chip ram.
 Установка:   расположить  в  стартапе  после  setpatch,  но  ДО  ДРУГИХ  патчей
занимающихся   подменой  функций  графики.   В  ENVARC:cgx  положить  три  файла
(PLANES2FAST,  SUPERGELS,  SUPERLAYERS)  размером в один байт содержащий "1" или
"0"  (ASCII)  единица включает фукцию, ноль выключает, рекомендую во всех файлах
вписать  единицу.   И необходимо переложить установки из ENVARC:  в ENV:  раньше
старта CGXAGA.
 К  сожалению эту программу не обошли ошибки.  Но основная масса их исправляется
программой  CyberBugFix.   Это  фактически  тоже,  что  и  CGXAGA,  но  с  более
расширенными  настройками  и  исправляющая практически все недостатки CGXAGA.  В
частности были замечены ошибки с не возвращением chip памяти при захвате битмапа
большого  объёма,  мусор  вместо  кнопок  в IBrowse, а также неработоспособность
некоторых
   программ.   Установка  её  аналогична CGXAGA, только с расширением усатновок.
Добавились  ещё  три файла в той же директории (DISPLAYABLE, INTERLEAVED, NOCGX,
PLANES2CHIP).

 PLANES2CHIP  -  список  имён процессов, все битмапы которых попадут в ChipRAM -
сейчас  там единственный пунктик prayer.  При отсутствии этого файла проверка на
имя процесса не выполняется.

INTERLEAVED  -  список  имён  процессов,  битмапы  которых  могут  быть с флагом
BMF_INTERLEAVED.  У всех прочих процессов этот флаг насильственно убирается.

DISPLAYABLE  -  список  имён  процессов,  все  битмапы которых, не имеющие флага
BMF_CLEAR,  насильственно  переносятся  в  FastRAM.  В частности, для DOpus5 это
приведёт к тому, что бэкграунды окажутся в фасте.

NOCGX  -  список  имён процессов, для которых будет недоступен CyberGraphX.  Это
необходимо  тем  программам,  которые  при обнаружении CGX свято верят в наличие
графической  карты,  и  пытаются  лезть  в  её  видеопамять.   В  частности, это
позволяет использовать MooVId совместно с CGXAGA.

 Но естественно эта программа не лишена минусов.  Главный недосаток, это то, что
битмапы  с  флагом  SMARTREFRESH  попадают  в  chip  ram,  что  уменьшает иногда
существенно  количество  chip  ram.   Поэтому,  выключите флаг SMARTКREFRESH или
включите  SIMPLEREFRESH  там, где это возможно.  Но к сожалению не все программы
предоставляют такую возможность.

                                     <B>FBlit</B>.

 Один из самых сильных патчей, даже если его использовать в одиночу будет давать
существенное ускорение и экономию chip ram.  FBlit подменяет стандартные функции
graphic.library  работающие  с  блитером  на  свои, а также отправляет битмапы в
fastram, что и даёт экономию chip'а.
 А  что  же  реально  даёт FBlit ?  Самое заметное на глаз - это резке ускорение
скролирования, особенно это заметно на браузерах.  Окна начинают гораздо шустрее
перемещаться  и  открываться.  Освобождается значительное колличество Chipram'а,
особенно  заметно  после  загрузки  ситемы  и при открывании окон, когда chipram
практиески не расходуется.  Фактически при использовании этой программы chip ram
расходуется  только  на  экраны,  да  и  на те программы, которые самостоятельно
захватывают  chipram  для  своих  нужд,  например всевозможные плееры для буфера
проигрывания музыки.
 Пропишите FBlit после SetPatch и копирования (монтирования) установок.  Если Вы
плохо  разбираетесь  в  его настройках, то оставте текущие и не трогайте пока не
начнёте понимать, что же они делают.
 Если  же  Вы  используете  CyberBugFix  (CGXAGA),  то  вам необходимо выключить
FAllocBitMap в установках fblit.
 Немного о версиях fbilt, рекомендуется ставить конечно же последнюю версию.  Но
самое  главное  не ставте fblit версией НИЖЕ 3.66.  Работа этих версий крайне не
корректна.

                                     <B>FText</B>

 Это  собственно  придаток  к  FBlit,  без него не функционирует.  Эта програмка
осуществляет  все  операции  с  печатью  текста на экран в fastram, что ускоряет
вывод текста на экран в два раза.  Ну естественно экономит чип память, но это не
сильно заметно т.к.  шрифты занимают не очень большой объём.  Установка проста -
программу необходимо разместить в стартапе сразу же после FBlit.

                                      <B>QBC</B>

 Подменяет  функцию  стирания  графики  с экрана.  Делает это быстрее чем FBlit.
Поэтому  если  хотите её установить, выключите в FBlit функцию FBlitClear, а QBC
положите в стартапе после fblit'а

                                    <B>BlazeWCP</B>

 Подменяет  сиcтемный  chuncky2planar.   Ускорется  работа программ использующих
данную   функцию,  в  частности  это  изветсный  image  processor  CandyFactory.
Желательно  использовать  совместно с FBlit прописав её в стартапе после данного
патча.

                                    <B>SmartWB</B>

 Эта  программа была первым моим патчем, который я установил, тогда ещё на голую
А1200.    SmartWB   надо   запускать   до  всех  патчей  отвечающих  за  графику
перечисленных  выше.   Этот патч занимется включением флага SmartRefresh во всех
окнах,  в которых он только может его включить.  И это ускоряет работу с окнами,
открытие и переключение между окнами.

Тестовая таблица
============================
SysSpeed V2.6  - TestResults
============================

 Test System : A1200 CPU: 68040  FPU: 68040   ChipSet: AGA   OS: 3.0

1 - Система без установленных патчей
2 - FBlit3.73xms, Ftext1.2, QBC, BlazeWCP

+-------------+---------+---------+
|   Test      |   1     |   2     |
+-------------+---------+---------+
|  Intuition    Results i Results i
+-------------+---------+---------+
| OpenWin16   |  10     |  6      |
+-------------+---------+---------+
| OpenWin256  |  5      |  4      |
+-------------+---------+---------+
| OpenWinHi   |  ----   |  ----   |
+-------------+---------+---------+
| OpenWinTru  |  ----   |  ----   |
+-------------+---------+---------+
| WinLayer16  |  7      |  9      |
+-------------+---------+---------+
| WinLayer256 |  3      |  5      |
+-------------+---------+---------+
| WinLayerHi  |  ----   |  ----   |
+-------------+---------+---------+
| WinLayerTru |  ----   |  ----   |
+-------------+---------+---------+
| SizeWin16   |  78     |  46     |
+-------------+---------+---------+
| SizeWin256  |  28     |  52     |
+-------------+---------+---------+
| SizeWinHi   |  ----   |  ----   |
+-------------+---------+---------+
| SizeWinTru  |  ----   |  ----   |
+-------------+---------+---------+
| MoveWin16   |  63     |  63     |
+-------------+---------+---------+
| MoveWin256  |  57     |  47     |
+-------------+---------+---------+
| MoveWinHi   |  ----   |  ----   |
+-------------+---------+---------+
| MoveWinTru  |  ----   |  ----   |
+-------------+---------+---------+
| ConOutP16   |  43     |  73     |
+-------------+---------+---------+
| ConOutP256  |  32     |  53     |
+-------------+---------+---------+
| ConOutPHi   |  ----   |  ----   |
+-------------+---------+---------+
| ConOutPTru  |  ----   |  ----   |
+-------------+---------+---------+
| OpenScr16   |  12     |  4      |
+-------------+---------+---------+
| OpenScr256  |  7      |  3      |
+-------------+---------+---------+
| OpenScrHi   |  ----   |  ----   |
+-------------+---------+---------+
| OpenScrTru  |  ----   |  ----   |
+-------------+---------+---------+
| SwapScr16   |  50     |  50     |
+-------------+---------+---------+
| SwapScr256  |  50     |  50     |
+-------------+---------+---------+
| SwapScrHi   |  ----   |  ----   |
+-------------+---------+---------+
| SwapScrTru  |  ----   |  ----   |
+-------------+---------+---------+
|  Graphic      Results i Results i
+-------------+---------+---------+
| ScrollX_16  |  8      |  15     |
+-------------+---------+---------+
| ScrollX_256 |  3      |  5      |
+-------------+---------+---------+
| ScrollX_Hi  |  ----   |  ----   |
+-------------+---------+---------+
| ScrollX_Tru |  ----   |  ----   |
+-------------+---------+---------+
| ScrollY_16  |  9      |  20     |
+-------------+---------+---------+
| ScrollY_256 |  3      |  7      |
+-------------+---------+---------+
| ScrollY_Hi  |  ----   |  ----   |
+-------------+---------+---------+
| ScrollY_Tru |  ----   |  ----   |
+-------------+---------+---------+
| PrintTxt16  |  743    |  2201   |
+-------------+---------+---------+
| PrintTxt256 |  338    |  1088   |
+-------------+---------+---------+
| PrintTxtHi  |  ----   |  ----   |
+-------------+---------+---------+
| PrintTxtTru |  ----   |  ----   |
+-------------+---------+---------+
| RectFill16  |  480    |  477    |
+-------------+---------+---------+
| RectFill256 |  187    |  187    |
+-------------+---------+---------+
| RectFillHi  |  ----   |  ----   |
+-------------+---------+---------+
| RectFillTru |  ----   |  ----   |
+-------------+---------+---------+
| DrwElpse16  |  385    |  387    |
+-------------+---------+---------+
| DrwElpse256 |  197    |  197    |
+-------------+---------+---------+
| DrwElpseHi  |  ----   |  ----   |
+-------------+---------+---------+
| DrwElpseTru |  ----   |  ----   |
+-------------+---------+---------+
| DrwCircle16 |  370    |  371    |
+-------------+---------+---------+
| DrCircle256 |  189    |  188    |
+-------------+---------+---------+
| DrwCircleHi |  ----   |  ----   |
+-------------+---------+---------+
| DrCircleTru |  ----   |  ----   |
+-------------+---------+---------+
| WrtPixel16  |  44219  |  43376  |
+-------------+---------+---------+
| WrtPixel256 |  27511  |  27153  |
+-------------+---------+---------+
| WrtPixelHi  |  ----   |  ----   |
+-------------+---------+---------+
| WrtPixelTru |  ----   |  ----   |
+-------------+---------+---------+
| HorLines16  |  279    |  3797   |
+-------------+---------+---------+
| HorLines256 |  108    |  1587   |
+-------------+---------+---------+
| HorLinesHi  |  ----   |  ----   |
+-------------+---------+---------+
| HorLinesTru |  ----   |  ----   |
+-------------+---------+---------+
| VerLines16  |  356    |  353    |
+-------------+---------+---------+
| VerLines256 |  137    |  137    |
+-------------+---------+---------+
| VerLinesHi  |  ----   |  ----   |
+-------------+---------+---------+
| VerLinesTru |  ----   |  ----   |
+-------------+---------+---------+
| DiaLines16  |  314    |  310    |
+-------------+---------+---------+
| DiaLines256 |  135    |  134    |
+-------------+---------+---------+
| DiaLinesHi  |  ----   |  ----   |
+-------------+---------+---------+
| DiaLinesTru |  ----   |  ----   |
+-------------+---------+---------+
| AreaElps16  |  200    |  203    |
+-------------+---------+---------+
| AreaElps256 |  116    |  117    |
+-------------+---------+---------+
| AreaElpsHi  |  ----   |  ----   |
+-------------+---------+---------+
| AreaElpsTru |  ----   |  ----   |
+-------------+---------+---------+
| AreaCir16   |  183    |  185    |
+-------------+---------+---------+
| AreaCir256  |  102    |  104    |
+-------------+---------+---------+
| AreaCirHi   |  ----   |  ----   |
+-------------+---------+---------+
| AreaCirTru  |  ----   |  ----   |
+-------------+---------+---------+
| AreaFill16  |  187    |  194    |
+-------------+---------+---------+
| AreaFill256 |  91     |  93     |
+-------------+---------+---------+
| AreaFillHi  |  ----   |  ----   |
+-------------+---------+---------+
| AreaFillTru |  ----   |  ----   |
+-------------+---------+---------+

 <B>Levitator/team PowerAmiga</B>
