                               PS/2 мышь на Амигу

     Обычные,  доступные и распространённые на компьютерах мыши фактически можно
отнести  к  «расходным  материалам»  -  вместе  с  картриджами  принтеров и тому
подобным.   Даже  если  регулярно  чистить  мышь,  рано или поздно «накрываются»
кнопки,  переламываются  жилы в кабеле, а то и изнашивается механика.  Даже если
при  наличии  соответствующей  квалификации ремонтировать это самостоятельно, то
всё равно рано или поздно наступает физический износ - в моей чёрной мыши стойки
для роликов износились настолько, что шарик уже значительно сместился в сторону:
ролики  проточили  в  них канавки миллиметра в полтора-два.  Плюс к тому нередки
«несчастные  случаи»  -  я  видел  мышь,  которую  владелец  спьяну  перепутал с
подставкой  для  паяльника.  Итогом этого становится рано или поздно наступающая
необходимость обзаводиться новой мышью.

     До  сих  пор  существовало  три  варианта:   покупка «родной» амижной мыши,
переделка  писишной и подключение писишных RS-232 мышей.  Все три варианта имеют
свои недостатки:

  1) Родные амижные мыши дороги (к примеру, популярная чёрная мышь в
     Кондоре стоит 17 долларов), и есть большие проблемы с их
     приобретением не в Москве/Питере.  Один раз можно съездить в
     Москву и потратить такую сумму, но когда нужен второй/третий/...
     раз - это уже становится накладно.

  2) Переделка доступна только для людей, умеющих держать в руках
     паяльник.  Кроме того, простой переделке поддаются только
     «классические» (с шариком и квадратурными датчиками) мыши.
     Оптические, беспроводные и тому подобные мыши не переделываются
     при всём желании.  Также есть ещё один момент - восьми (или
     девяти, если хочется три кнопки) жильный кабель, достаточно
     тонкий и гибкий для мыши, являет собой весьма большую редкость.

  3) Мыши на RS-232 имеют один чудовищный недостаток, который напрочь
     перечёркивает все их прочие достоинства, действительные или
     мнимые.  Заключается он в том, что RS-232 мышь может сообщить об
     изменении своего состояния максимум 40 раз в секунду.  А если
     Вам захотелось три кнопки, то это будет уже 25 раз в секунду!
     Поскольку указанное число заметно меньше кадровой частоты любого
     видеорежима, то итогом является конвульсивное дёрганье мышиного
     курсора, совершенно не сравнимое с потрясающей своей идеальностью
     плавностью движения родной амижной мыши.

     RS-232  мыши  можно  подключить  двумя способами - с помощью переходника на
мышиный  порт  (доступен  ряд  как коммерческих, так и свободно распространяемых
решений),  или  просто  воткнув в RS-232.  Последний вариант - из серии «хуже не
придумаешь»,  поскольку  это  не только будет работать только в системе и только
после  запуска  драйвера  мыши,  но ещё и забирать единственный имеющийся RS-232
порт,  не  оставляя возможности подключения внешнего модема без специальных плат
расширения.

     Ситуация  стала  совершенно  иной  (без  преувеличений), когда я разработал
переходник  на  PS/2  мыши.   PS/2  -  достаточно  старый  стандарт, завоевавший
популярность  на  PC  в  последнее время благодаря тому, что по стандарту ATX на
материнской  плате должен присутствовать PS/2 интерфейс.  Основным преимуществом
PS/2  мышей  перед  RS-232  вариантом  является  то,  что  они могут сообщать об
изменении  своего состояния до 200 раз в секунду - и от количества кнопок (как и
прочих  «наворотов») мыши это число не зависит совершенно.  Вторым преимуществом
PS/2  является стандартное пятивольтовое питание (против двуполярных 12 вольт на
RS-232),  не  требующее  от  переходника преобразователя напряжения.  PS/2 будет
использоваться в BoXeR-е, но для начала следовало бы позаботиться о существующем
парке Амиг.

     Даже  несмотря  на  «магическое  число»  200,  я  реализовал  в переходнике
линейную интерполяцию, руководствуясь которой переходник плавно перемещает mouse
pointer  между  сообщениями  с  мыши.   За  счёт  этого  решения плавность будет
сохранена  на  любых  кадровых  частотах,  даже превышающих 200 герц - что будет
весьма  полезно  для  владельцев видеокарт.  Переходник с максимальной точностью
симулирует  «родную»  амижную  трёхкнопочную  мышь,  очевидно, не требуя никаких
драйверов.   Таким  образом, теперь на Амиге идеально плавно ездят даже писишные
мыши :)

     Кроме  того,  переходник  имеет  ещё ряд интересных особенностей.  На Амиге
есть  мало кому известная проблема - если мышь перемещена более чем на 127 точек
за  один  обратный ход луча (при кадровой частоте 50 герц это соответствует 6350
точек  в секунду), то счётчики перемещения мыши чипсета Амиги переполняются, и с
точки   зрения   Амиги  мышь...   двигается  в  другую  сторону.   Эта  проблема
проявляется  на мышах, имеющих разрешение, превышающее обычные 300-400dpi (dpi =
dots  per  inch  = точки на дюйм).  В частности, встречаются мыши с 560dpi.  Для
обхода  этой  проблемы на Аминете доступна даже специальная утилитка - однако, и
она  не  решает  проблемы  перемещения  соответственно более чем на 255 точек на
кадр.
     В  переходнике такая ситуация отслеживается аппаратно - перемещение мыши со
скоростью  выше  чем  6000  точек  в секунду не допускается.  Если мышь движется
быстрее  -  перемещение  будет  запомнено,  и она всё равно «доедет» до заданной
точки - только с чуть меньшей скоростью.  Такое решение обеспечивает возможность
использования  абсолютно любых мышей во всех видеорежимах, используемых на Амиге
(даже на дефолтовом DblPAL без VGAonly, где кадровая частота составляет всего 48
герц).
     Вторая  особенность  переходника  -  он позволяет без опасений «перетыкать»
мышь  на ходу.  Смена мыши отслеживается и обслуживается в течение полутора-двух
секунд.
     Третья  особенность - переходник имеет возможность аппаратного сброса мыши.
Если  мышь  вдруг  «зависла»  (а  с  китайскими может случиться и не такое...) -
переходник  на  некоторое  время выключит ей питание.  Такой подход позволяет на
100%  гарантировать  отсутствие возможности зависания.  Так же как и смена мыши,
зависание  будет  отслежено  максимум  за  две секунды.  На PC же такая ситуация
потребует перетыкания мыши (если не перезагрузки Windoze).

     Кроме  очевидных  его  достоинств,  приплюсуем  так  же и не так очевидные.
Распространённые  на  Амиге  мыши обычно имеют две кнопки.  На рынке PC же очень
легко  купить  трёхкнопочную  мышь.   Средняя  кнопка  позволяет,  к  примеру, с
удобством  скроллировать  (плавно) Web-страницы в IBrowse 2.2 и открывать лупу в
Apdf.  А при соответствующей настройке третью кнопку можно использовать для чего
угодно  -  переключения  экранов,  вызова  событий  по кнопка DOpus-а, возврат в
предыдущую директорию в нём же и так далее.
     Также  переходник  даёт  возможность  использования  экзотических  мышей  -
беспроводных  и  оптических.   Если  преимущества  беспроводных ясны всем, то на
оптических  остановимся  поподробнее:  это мыши, не имеющие механических частей.
Большинство  из  них  требует  специального  коврика,  но это небольшая плата за
отсутствие  износа  (служат  они десятки лет) и необходимости чистить мышь.  А в
последнее  время,  как  говорят,  появились  оптические  мыши, даже не требующие
спец.коврика!

     Надеюсь,  что  вышенаписанное  прояснило ситуацию с переходником.  Осталось
решить лишь очень простой вопрос - где его взять :)
     Поскольку  лично я не собираюсь заниматься его производством, а желающих им
обзавестись  вокруг  множество,  я  передал право на его производство московской
фирме  Кондор.   Переходник  появится  там  в  продаже  к  середине  мая  2000г.
Интересующиеся  могут  звонить  в  Кондор  по телефону (095) 300-1551 и узнавать
подробности.
     Однако,  у  Вас  есть  возможность  неплохо  сэкономить,  спаяв  переходник
самостоятельно.   Поэтому  всем  желающим предлагается такой вариант - привозить
микросхему  ко  мне,  и  я  её буду «зашивать» за символическое вознаграждение в
размере  одной  двухлитровой  бутылки  PEPSI (не «light»!).  Если Вы живёте не в
Москве - договоритесь со знакомыми, которые едут в Москву, чтобы они сделали это
за  Вас  (с  почтой  я связываться не буду).  Оптимальный вариант - найдите всех
желающих  спаять  переходник  в  своём  городе  и  передайте мне сразу несколько
микросхем.   Зашивка  микросхемы занимает несколько секунд и будет сделана сразу
же.

     Перейдём  к технической стороне вопроса.  Переходник выполнен на микросхеме
PIC16C554  производства американской компании Microchip.  Стоит эта микросхема в
Москве  порядка  2у.е.   Если  её  не будет в продаже, также годится PIC16C558 -
отличающаяся  бОльшим  объёмом памяти, но полностью совместимая.  Эти микросхемы
представляют  собой  микроконтроллеры  (МК)  -  фактически маленькие компьютеры,
имеющие  собственный  восьмибитный  процессор  с  быстродействием до 5 миллионов
оп/с,  память программ, оперативную память для данных, порты, таймер и некоторые
другие  возможности.   МК  данного  типа  бывают  с  тактовыми  частотами 4 и 20
мегагерц.   В  нашем  случае  достаточно  4-мегагерцевых  (20-мегагерцевые  тоже
годятся,  но  переплачивать смысла нет).  Второе различие этих МК - они бывают в
разных  корпусах.  В данном случае весьма желателен корпус DIP - по той причине,
что имеющийся у меня программатор рассчитан на DIP-корпус.
     После надписи PIC16C554 следует тактовая частота через тире, а также буквы,
означающие  исполнение  (корпус  и температурный диапазон).  До тире также может
присутствовать  буква  A - это чуть более новая версия кристалла (тоже годится).
Существуют  также  варианты  в  керамическом  корпусе  с окном (/JW) - они стоят
значительно  дороже,  предназначены  для  отладки  (их можно многократно стирать
ультрафиолетовой лампой), и применять здесь их смысла нет.

     Кроме этого, понадобятся следующие детали:

   - разъём DB-9F, который вставляется в мышиный порт Амиги,
   - разъём MiniDIN-6F, в который втыкается PS/2 мышь,
   - кварцевый резонатор на 4 мегагерца,
   - два конденсатора по 20 пикофарад каждый,
   - конденсатор 0.1 микрофарады,
   - резистор на 2 килоома.

     Собственный  экземпляр  переходника  я собрал прямо в корпусе разъёма DB-9.
Тут  нужен защёлкивающийся корпус (сворачивающийся винтами не годится - туда всё
попросту  не  уместится).   Также годится корпус переходника «девять на девять».
Необходимости в печатной плате нет - всё собирается «на весу».
     Схема  переходника прилагается к журналу - файл ps2m.ilbm.  Конденсаторы по
20  пикофарад  в  принципе  необязательны,  и  если  без них переходник работает
стабильно - можно оставить всё как есть.  Блокировочный конденсатор 0.1мкФ также
необязателен.   Хотя,  «по  науке»  желательно  их всё-таки поставить.  Резистор
предназначен  для  разрядки  конденсатора внутри мыши и обязателен - в противном
случае успешность сброса мыши будет уже не 100%.
     Собранный переходник должен начать работать сразу и в наладке не нуждается.
Неработоспособность может означать две вещи - либо ошибку при сборке (тут будьте
осторожны - PIC легко вывести из строя неправильным подключением питания!), либо
несовместимость  с  имеющейся мышью.  Я не могу гарантировать 100% совместимость
со всеми существующими мышами, однако в настоящий момент ни одного такого случая
выявлено  не было - проверено на десятке разных мышей, включая «самые китайские»
;)  Если  всё-таки такая мышь попадётся - несите её мне.  А ещё лучше - вместе с
PICом  привозите  её  сразу,  я проверю на существующем варианте прошивки, и при
необходимости доработаю её.

     Следует  также  остановиться  на  таком  явлении, как «переходник RS-232 на
PS/2»,  встречающемся  на  PC.   Действительно, бывают такие мыши, которые имеют
RS-232  разъём,  снабжены подобным переходником и прекрасно работают как PS/2 (у
меня самого одна из мышей - как раз такая).  Однако, этот писишный переходник НЕ
БУДЕТ работать с абстрактно взятой RS-232 мышью.  Мышь должна поддерживать такой
режим работы.

     С вопросами и предложениями обращайтесь ко мне:

     2:5020/1301.7
     rdc@cch.pmc.ru
     (095) 352-0931 Денис

     Звонить по будням имеет смысл днём 16:00-17:30 или вечером в
     22:30, в выходные - 16:00-22:45.  Зовите только меня - с кем
     либо ещё разговаривать на подобные темы бессмысленно.

